// api.js — простой клиент для работы с backend API// Базовый URL можно сменить при деплое (например, на https://server.com/api)const Api = (function () {    const BASE_URL = '/api';    const TOKEN_KEY = 'kd_auth_token';    const USER_KEY  = 'kd_auth_user';    // ============ helpers ============    function getToken() {        return localStorage.getItem(TOKEN_KEY);    }    function setToken(token) {        if (token) {            localStorage.setItem(TOKEN_KEY, token);        } else {            localStorage.removeItem(TOKEN_KEY);        }    }    function saveUser(user) {        if (user) {            localStorage.setItem(USER_KEY, JSON.stringify(user));        } else {            localStorage.removeItem(USER_KEY);        }    }    function getUserFromStorage() {        const raw = localStorage.getItem(USER_KEY);        if (!raw) return null;        try {            return JSON.parse(raw);        } catch {            return null;        }    }    async function request(path, options = {}) {        const headers = Object.assign(            { 'Content-Type': 'application/json' },            options.headers || {}        );        const token = getToken();        if (token) {            headers['Authorization'] = `Bearer ${token}`;        }        const res = await fetch(BASE_URL + path, {            ...options,            headers        });        let data = null;        try {            data = await res.json();        } catch {            data = null;        }        if (!res.ok) {            const err = new Error(data?.message || 'API error');            err.status = res.status;            err.data = data;            throw err;        }        return data;    }    // ============ auth ============    async function register({ name, email, password, accountType }) {        const data = await request('/auth/register', {            method: 'POST',            body: JSON.stringify({ name, email, password, accountType })        });        if (data.token) setToken(data.token);        if (data.user) saveUser(data.user);        return data;    }    async function login({ email, password }) {        const data = await request('/auth/login', {            method: 'POST',            body: JSON.stringify({ email, password })        });        if (data.token) setToken(data.token);        if (data.user) saveUser(data.user);        return data;    }    async function getCurrentUser() {        const cached = getUserFromStorage();        if (cached) return cached;        try {            const data = await request('/auth/me', { method: 'GET' });            if (data.user) saveUser(data.user);            return data.user || null;        } catch {            return null;        }    }    function logout() {        setToken(null);        saveUser(null);    }    // ============ NKO ============    async function createNko(payload) {        // payload: {name, category, description, volunteers, phone, address, city, website, logo, filters}        return await request('/nko', {            method: 'POST',            body: JSON.stringify(payload)        });    }    async function listNko() {        return await request('/nko', { method: 'GET' });    }    return {        request,        register,        login,        getCurrentUser,        logout,        createNko,        listNko,        getToken,        getUserFromStorage    };})();// делаем глобальнымwindow.Api = Api;